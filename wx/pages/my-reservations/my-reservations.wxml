<!--pages/my-reservations/my-reservations.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨Tabåˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === 'all' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="tab-item {{currentTab === 'PENDING' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="PENDING"
    >
      å¾…å®¡æ ¸
    </view>
    <view 
      class="tab-item {{currentTab === 'APPROVED' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="APPROVED"
    >
      å·²é€šè¿‡
    </view>
    <view 
      class="tab-item {{currentTab === 'REJECTED' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="REJECTED"
    >
      å·²æ‹’ç»
    </view>
    <view 
      class="tab-item {{currentTab === 'CANCELLED' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="CANCELLED"
    >
      å·²å–æ¶ˆ
    </view>
    <view 
      class="tab-item {{currentTab === 'COMPLETED' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="COMPLETED"
    >
      å·²å®Œæˆ
    </view>
  </view>

  <!-- é¢„çº¦åˆ—è¡¨ -->
  <scroll-view 
    class="reservation-list" 
    scroll-y 
    bindscrolltolower="loadMore"
    lower-threshold="100"
  >
    <view 
      class="reservation-item"
      wx:for="{{reservations}}"
      wx:key="id"
      bindtap="goToDetail"
      data-id="{{item.id}}"
    >
      <!-- çŠ¶æ€æ ‡ç­¾ -->
      <view class="status-badge status-{{item.status}}">
        {{statusMap[item.status]}}
      </view>

      <!-- å®éªŒå®¤ä¿¡æ¯ -->
      <view class="lab-info">
        <view class="lab-name">{{item.laboratory.name}}</view>
        <view class="lab-location">{{item.laboratory.location}}</view>
      </view>

      <!-- é¢„çº¦ä¿¡æ¯ -->
      <view class="reservation-info">
        <view class="info-row">
          <text class="label">é¢„çº¦æ—¥æœŸï¼š</text>
          <text class="value">{{item.reservationDate}}</text>
        </view>
        <view class="info-row">
          <text class="label">æ—¶é—´æ®µï¼š</text>
          <text class="value">{{item.timeslot.startTime}} - {{item.timeslot.endTime}}</text>
        </view>
        <view class="info-row">
          <text class="label">é¢„çº¦äººæ•°ï¼š</text>
          <text class="value">{{item.numberOfPeople}}äºº</text>
        </view>
        <view class="info-row">
          <text class="label">é¢„çº¦ç›®çš„ï¼š</text>
          <text class="value">{{item.purpose}}</text>
        </view>
        <view class="info-row" wx:if="{{item.rejectionReason}}">
          <text class="label">æ‹’ç»åŸå› ï¼š</text>
          <text class="value reason">{{item.rejectionReason}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="actions">
        <button 
          class="action-btn detail-btn"
          size="mini"
          bindtap="goToDetail"
          data-id="{{item.id}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        <button 
          class="action-btn cancel-btn"
          size="mini"
          wx:if="{{item.status === 'PENDING' || item.status === 'APPROVED'}}"
          bindtap="cancelReservation"
          data-id="{{item.id}}"
          catchtap="preventBubble"
        >
          å–æ¶ˆé¢„çº¦
        </button>
        <button 
          class="action-btn complete-btn"
          size="mini"
          wx:if="{{item.status === 'APPROVED'}}"
          bindtap="completeReservation"
          data-id="{{item.id}}"
          catchtap="preventBubble"
        >
          å®Œæˆé¢„çº¦
        </button>
      </view>

      <!-- åˆ›å»ºæ—¶é—´ -->
      <view class="create-time">åˆ›å»ºæ—¶é—´ï¼š{{item.createdAt}}</view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && reservations.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty" wx:if="{{!loading && reservations.length === 0}}">
      <view class="empty-icon">ğŸ“‹</view>
      <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
      <navigator url="/pages/laboratory-list/laboratory-list" class="goto-lab-btn">
        å»é¢„çº¦å®éªŒå®¤
      </navigator>
    </view>
  </scroll-view>
</view>
