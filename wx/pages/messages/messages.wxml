<!--pages/messages/messages.wxml-->
<view class="messages-container">
  <!-- æœªè¯»æ¶ˆæ¯ç»Ÿè®¡ -->
  <view class="unread-banner" wx:if="{{unreadCount > 0}}">
    <view class="unread-info">
      <text class="unread-icon">ğŸ“¬</text>
      <text class="unread-text">æ‚¨æœ‰ {{unreadCount}} æ¡æœªè¯»æ¶ˆæ¯</text>
    </view>
    <button class="mark-all-btn" bindtap="markAllAsRead" size="mini">å…¨éƒ¨æ ‡è®°å·²è¯»</button>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="message-list" wx:if="{{messageList.length > 0}}">
    <view 
      class="message-item {{item.isRead ? 'read' : 'unread'}}" 
      wx:for="{{messageList}}" 
      wx:key="id"
      bindtap="goToDetail"
      data-id="{{item.id}}"
    >
      <view class="message-header">
        <view class="message-type-badge type-{{item.type}}">
          <text class="type-icon">{{getTypeIcon(item.type)}}</text>
          <text class="type-text">{{getTypeText(item.type)}}</text>
        </view>
        <view class="message-time">{{formatTime(item.createdAt)}}</view>
      </view>

      <view class="message-title">
        <text class="unread-dot" wx:if="{{!item.isRead}}"></text>
        <text class="title-text">{{item.title}}</text>
      </view>

      <view class="message-content">{{item.content}}</view>

      <!-- é¢„çº¦ç›¸å…³ä¿¡æ¯ -->
      <view class="related-info" wx:if="{{item.reservationId}}">
        <text class="info-icon">ğŸ”—</text>
        <text class="info-text">é¢„çº¦ç¼–å·ï¼š{{item.reservationNumber || item.reservationId}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{messageList.length === 0 && !loading}}">
    <image class="empty-icon" src="/images/empty-message.png" mode="aspectFit"></image>
    <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loadingMore}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{noMore && messageList.length > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ¶ˆæ¯äº†</text>
  </view>
</view>
