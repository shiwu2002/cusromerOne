<!--pages/messages/messages.wxml-->
<view class="messages-container">
  <!-- æœªè¯»æ¶ˆæ¯ç»Ÿè®¡ -->
  <view class="unread-banner" wx:if="{{unreadCount > 0}}">
    <view class="unread-info">
      <text class="unread-icon">ğŸ“¬</text>
      <text class="unread-text">æ‚¨æœ‰ {{unreadCount}} æ¡æœªè¯»æ¶ˆæ¯</text>
    </view>
    <button class="mark-all-btn" bindtap="markAllAsRead" size="mini">å…¨éƒ¨æ ‡è®°å·²è¯»</button>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾å¯¼èˆª -->
  <view class="category-tabs">
    <scroll-view class="tab-scroll" scroll-x="true" scroll-with-animation="true">
      <view 
        class="tab-item {{item.active ? 'active' : ''}}" 
        wx:for="{{categories}}" 
        wx:key="type"
        bindtap="switchCategory"
        data-type="{{item.type}}"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
        <text class="tab-count" wx:if="{{item.count > 0}}">{{item.count}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="message-list" wx:if="{{filteredMessageList.length > 0}}">
    <view 
      class="message-item {{item.isRead ? 'read' : 'unread'}} priority-{{getPriorityClass(item.priority)}}" 
      wx:for="{{filteredMessageList}}" 
      wx:key="id"
      bindtap="goToDetail"
      data-id="{{item.id}}"
    >
      <view class="message-header">
        <view class="message-info-left">
          <view class="message-type-badge type-{{item.messageType}}">
            <text class="type-icon">{{getTypeIcon(item.messageType)}}</text>
            <text class="type-text">{{getTypeText(item.messageType)}}</text>
          </view>
          <!-- ä¼˜å…ˆçº§æŒ‡ç¤ºå™¨ -->
          <text class="priority-indicator" wx:if="{{item.priority > 0}}">{{getPriorityIcon(item.priority)}}</text>
        </view>
        <view class="message-info-right">
          <view class="message-time">{{formatTime(item.createTime)}}</view>
          <text class="sender-info" wx:if="{{item.senderName}}">{{item.senderName}}</text>
        </view>
      </view>

      <view class="message-title">
        <text class="unread-dot" wx:if="{{!item.isRead}}"></text>
        <text class="title-text">{{item.title}}</text>
      </view>

      <view class="message-content">{{item.content}}</view>

      <!-- å…³è”é¢„çº¦ä¿¡æ¯ -->
      <view class="related-info" wx:if="{{item.relatedType === 'reservation' && item.relatedId}}">
        <text class="info-icon">ğŸ“…</text>
        <text class="info-text">é¢„çº¦ç¼–å·ï¼š{{item.relatedId}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredMessageList.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ’Œ</view>
    <text class="empty-text" wx:if="{{activeCategory === 'all'}}">æš‚æ— æ¶ˆæ¯</text>
    <text class="empty-text" wx:elif="{{activeCategory !== 'all' && hasEmptyCategory}}">è¯¥åˆ†ç±»æš‚æ— æ¶ˆæ¯</text>
    <text class="empty-text" wx:else>æš‚æ— ç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loadingMore}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{noMore && messageList.length > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ¶ˆæ¯äº†</text>
  </view>
</view>
