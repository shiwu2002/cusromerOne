<!--pages/reservation-detail/reservation-detail.wxml-->
<view class="container">
  <!-- çŠ¶æ€å¡ç‰‡ -->
  <view class="status-card status-{{reservation.status}}">
    <view class="status-icon">
      <text wx:if="{{reservation.status === 'PENDING'}}">â³</text>
      <text wx:if="{{reservation.status === 'APPROVED'}}">âœ“</text>
      <text wx:if="{{reservation.status === 'REJECTED'}}">âœ•</text>
      <text wx:if="{{reservation.status === 'CANCELLED'}}">âŠ—</text>
      <text wx:if="{{reservation.status === 'COMPLETED'}}">â˜…</text>
    </view>
    <view class="status-text">{{statusMap[reservation.status]}}</view>
    <view class="status-tip" wx:if="{{reservation.status === 'PENDING'}}">
      è¯·è€å¿ƒç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸
    </view>
    <view class="status-tip" wx:if="{{reservation.status === 'APPROVED'}}">
      é¢„çº¦å·²é€šè¿‡ï¼Œè¯·æŒ‰æ—¶åˆ°è¾¾å®éªŒå®¤
    </view>
  </view>

  <!-- å®éªŒå®¤ä¿¡æ¯ -->
  <view class="section">
    <view class="section-title">å®éªŒå®¤ä¿¡æ¯</view>
    <view class="lab-card" bindtap="goToLaboratory">
      <image 
        class="lab-image" 
        src="{{reservation.laboratory.images[0] || '/images/lab-default.png'}}"
        mode="aspectFill"
      ></image>
      <view class="lab-info">
        <view class="lab-name">{{reservation.laboratory.name}}</view>
        <view class="lab-location">ğŸ“ {{reservation.laboratory.location}}</view>
        <view class="lab-capacity">ğŸ‘¥ å®¹çº³äººæ•°ï¼š{{reservation.laboratory.capacity}}äºº</view>
      </view>
      <view class="lab-arrow">â€º</view>
    </view>
  </view>

  <!-- é¢„çº¦ä¿¡æ¯ -->
  <view class="section">
    <view class="section-title">é¢„çº¦ä¿¡æ¯</view>
    <view class="info-card">
      <view class="info-row">
        <view class="info-label">é¢„çº¦ç¼–å·</view>
        <view class="info-value">{{reservation.id}}</view>
      </view>
      <view class="info-row">
        <view class="info-label">é¢„çº¦æ—¥æœŸ</view>
        <view class="info-value highlight">{{reservation.reservationDate}}</view>
      </view>
      <view class="info-row">
        <view class="info-label">æ—¶é—´æ®µ</view>
        <view class="info-value highlight">
          {{reservation.timeslot.startTime}} - {{reservation.timeslot.endTime}}
        </view>
      </view>
      <view class="info-row">
        <view class="info-label">é¢„çº¦äººæ•°</view>
        <view class="info-value">{{reservation.numberOfPeople}}äºº</view>
      </view>
      <view class="info-row">
        <view class="info-label">é¢„çº¦ç›®çš„</view>
        <view class="info-value">{{reservation.purpose}}</view>
      </view>
      <view class="info-row" wx:if="{{reservation.notes}}">
        <view class="info-label">å¤‡æ³¨è¯´æ˜</view>
        <view class="info-value">{{reservation.notes}}</view>
      </view>
    </view>
  </view>

  <!-- é™„ä»¶æ–‡æ¡£ -->
  <view class="section" wx:if="{{reservation.documents && reservation.documents.length > 0}}">
    <view class="section-title">é™„ä»¶æ–‡æ¡£</view>
    <view class="documents">
      <view 
        class="document-item"
        wx:for="{{reservation.documents}}"
        wx:key="index"
        bindtap="previewDocument"
        data-url="{{item}}"
      >
        <view class="document-icon">ğŸ“„</view>
        <view class="document-name">æ–‡æ¡£{{index + 1}}</view>
        <view class="document-action">æŸ¥çœ‹</view>
      </view>
    </view>
  </view>

  <!-- æ‹’ç»åŸå›  -->
  <view class="section" wx:if="{{reservation.status === 'REJECTED' && reservation.rejectionReason}}">
    <view class="section-title">æ‹’ç»åŸå› </view>
    <view class="rejection-card">
      <view class="rejection-icon">âš ï¸</view>
      <view class="rejection-text">{{reservation.rejectionReason}}</view>
    </view>
  </view>

  <!-- æ—¶é—´ä¿¡æ¯ -->
  <view class="section">
    <view class="section-title">æ—¶é—´è®°å½•</view>
    <view class="time-card">
      <view class="time-row">
        <view class="time-label">åˆ›å»ºæ—¶é—´</view>
        <view class="time-value">{{reservation.createdAt}}</view>
      </view>
      <view class="time-row">
        <view class="time-label">æ›´æ–°æ—¶é—´</view>
        <view class="time-value">{{reservation.updatedAt}}</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{reservation.status === 'PENDING' || reservation.status === 'APPROVED'}}">
    <button 
      class="action-btn cancel-btn"
      wx:if="{{reservation.status === 'PENDING' || reservation.status === 'APPROVED'}}"
      bindtap="cancelReservation"
    >
      å–æ¶ˆé¢„çº¦
    </button>
    <button 
      class="action-btn complete-btn"
      wx:if="{{reservation.status === 'APPROVED'}}"
      bindtap="completeReservation"
    >
      å®Œæˆé¢„çº¦
    </button>
  </view>
</view>
