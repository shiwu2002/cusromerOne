<!--pages/lab-selection/lab-selection.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å®éªŒå®¤åç§°" 
        value="{{keyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
      <text class="clear-icon" wx:if="{{keyword}}" bindtap="onClearSearch">Ã—</text>
    </view>
    <view class="filter-btn" bindtap="toggleFilter">
      <text class="filter-icon">ç­›é€‰</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{filterVisible}}">
    <view class="filter-title">çŠ¶æ€ç­›é€‰</view>
    <view class="filter-options">
      <view 
        class="filter-option {{statusFilter === null ? 'active' : ''}}" 
        bindtap="resetFilter"
        data-status="{{null}}"
      >
        <text>å…¨éƒ¨</text>
      </view>
      <view 
        class="filter-option {{statusFilter === 1 ? 'active' : ''}}" 
        bindtap="selectStatus"
        data-status="1"
      >
        <text>å¯ç”¨</text>
      </view>
      <view 
        class="filter-option {{statusFilter === 0 ? 'active' : ''}}" 
        bindtap="selectStatus"
        data-status="0"
      >
        <text>ç»´æŠ¤ä¸­</text>
      </view>
    </view>
  </view>

  <!-- å®éªŒå®¤åˆ—è¡¨ -->
  <scroll-view class="lab-list" scroll-y="{{true}}" bindscrolltolower="loadMore">
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <view class="loading-wrapper" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- å®éªŒå®¤å¡ç‰‡ -->
    <view 
      class="lab-card" 
      wx:for="{{laboratories}}" 
      wx:key="id"
      bindtap="selectLaboratory"
      data-laboratory="{{item}}"
    >
      <image src="{{item.imageUrl}}" mode="aspectFill" class="lab-image" lazy-load="{{true}}"></image>
      <view class="lab-info">
        <view class="lab-header">
          <text class="lab-name">{{item.labName}}</text>
          <view class="lab-status status-{{item.status === 1 ? 'available' : 'unavailable'}}">
            <text class="status-dot"></text>
            <text class="status-text">{{item.status === 1 ? 'å¯ç”¨' : 'ç»´æŠ¤ä¸­'}}</text>
          </view>
        </view>
        <text class="lab-location">ğŸ“ {{item.location}}</text>
        <view class="lab-meta">
          <text class="lab-capacity">ğŸ‘¥ {{item.capacity}}äºº</text>
          <text class="lab-type">ğŸ”¬ {{item.labType}}</text>
        </view>
        <text class="lab-description">{{item.description}}</text>
      </view>
      <view class="select-btn">
        <text class="select-text">é€‰æ‹©é¢„çº¦</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && laboratories.length === 0}}">
      <text class="empty-icon">ğŸ”¬</text>
      <text class="empty-text">æš‚æ— å¯ç”¨å®éªŒå®¤</text>
      <text class="empty-subtext">è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–ç¨åé‡è¯•</text>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å–æ¶ˆæŒ‰é’® -->
  <view class="footer">
    <button class="cancel-btn" bindtap="onCancel">å–æ¶ˆ</button>
  </view>
</view>
