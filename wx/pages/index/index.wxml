<!--pages/index/index.wxml-->
<view class="container">
  <!-- è½®æ’­å›¾ -->
  <swiper wx:if="{{banners.length > 0}}" class="banner-swiper" indicator-dots="{{true}}" autoplay="{{true}}" interval="{{3000}}" duration="{{500}}" circular="{{true}}">
    <swiper-item wx:for="{{banners}}" wx:key="id">
      <image src="{{item.image}}" mode="aspectFill" class="banner-image" lazy-load="{{true}}"></image>
    </swiper-item>
  </swiper>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-menu">
    <view class="menu-item" bindtap="navigateToReservation">
      <view class="menu-icon">
        <text class="iconfont">ğŸ“…</text>
      </view>
      <text class="menu-text">æˆ‘è¦é¢„çº¦</text>
    </view>
    <view class="menu-item" bindtap="navigateToMyReservations">
      <view class="menu-icon">
        <text class="iconfont">ğŸ“‹</text>
      </view>
      <text class="menu-text">æˆ‘çš„é¢„çº¦</text>
    </view>
    <view class="menu-item" bindtap="navigateToMessages">
      <view class="menu-icon">
        <text class="iconfont">âœ‰ï¸</text>
        <view class="badge" wx:if="{{unreadCount > 0}}">{{unreadCount > 99 ? '99+' : unreadCount}}</view>
      </view>
      <text class="menu-text">æ¶ˆæ¯é€šçŸ¥</text>
    </view>
    <view class="menu-item" bindtap="navigateToProfile">
      <view class="menu-icon">
        <text class="iconfont">ğŸ‘¤</text>
      </view>
      <text class="menu-text">ä¸ªäººä¸­å¿ƒ</text>
    </view>
  </view>

  <!-- å…¬å‘Šæ  -->
  <view class="notice-bar" wx:if="{{notices.length > 0}}">
    <text class="notice-icon">ğŸ“¢</text>
    <swiper class="notice-swiper" vertical="{{true}}" autoplay="{{true}}" interval="{{4000}}" duration="{{500}}" circular="{{true}}">
      <swiper-item wx:for="{{notices}}" wx:key="index">
        <text class="notice-text">{{item}}</text>
      </swiper-item>
    </swiper>
  </view>

  <!-- æ¨èå®éªŒå®¤ -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">æ¨èå®éªŒå®¤</text>
      <text class="section-more" bindtap="navigateToLaboratoryList">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>

    <!-- éª¨æ¶å± -->
    <view class="skeleton-list" wx:if="{{showSkeleton && laboratories.length === 0}}">
      <view class="skeleton-card" wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="skeleton-image"></view>
        <view class="skeleton-info">
          <view class="skeleton-line skeleton-title"></view>
          <view class="skeleton-line skeleton-text"></view>
          <view class="skeleton-line skeleton-text short"></view>
        </view>
      </view>
    </view>

    <!-- å®éªŒå®¤åˆ—è¡¨ -->
    <view class="lab-list" wx:else>
      <view class="lab-card" wx:for="{{laboratories}}" wx:key="id" bindtap="navigateToLaboratoryDetail" data-id="{{item.id}}">
        <image src="{{item.imageUrl}}" mode="aspectFill" class="lab-image" lazy-load="{{true}}"></image>
        <view class="lab-info">
          <view class="lab-header">
            <text class="lab-name">{{item.labName}}</text>
            <view class="lab-status status-{{item.status === 1 ? 'available' : 'unavailable'}}">
              <text class="status-dot"></text>
              <text class="status-text">{{item.status === 1 ? 'å¯ç”¨' : (item.status === 0 ? 'ç»´æŠ¤ä¸­' : 'åœç”¨')}}</text>
            </view>
          </view>
          <text class="lab-location">ğŸ“ {{item.location}}</text>
          <view class="lab-meta">
            <text class="lab-capacity">ğŸ‘¥ {{item.capacity}}äºº</text>
            <text class="lab-type">ğŸ”¬ {{item.labType}}</text>
          </view>
          <text class="lab-description">{{item.description}}</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{laboratories.length === 0 && !showSkeleton}}">
        <text class="empty-icon">ğŸ”¬</text>
        <text class="empty-text">æš‚æ— æ¨èå®éªŒå®¤</text>
        <view class="empty-action">
          <button class="empty-btn" bindtap="navigateToLaboratoryList">æµè§ˆå…¨éƒ¨å®éªŒå®¤</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ç»Ÿè®¡ -->
  <view class="section statistics-section" wx:if="{{statistics}}">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„é¢„çº¦ç»Ÿè®¡</text>
      <text class="section-more" bindtap="navigateToMyReservations">æŸ¥çœ‹è¯¦æƒ… ></text>
    </view>
    <view class="statistics-grid">
      <view class="stat-item" bindtap="navigateToMyReservations">
        <text class="stat-value stat-pending">{{statistics.pending || 0}}</text>
        <text class="stat-label">å¾…å®¡æ ¸</text>
      </view>
      <view class="stat-item" bindtap="navigateToMyReservations">
        <text class="stat-value stat-approved">{{statistics.approved || 0}}</text>
        <text class="stat-label">å·²é€šè¿‡</text>
      </view>
      <view class="stat-item" bindtap="navigateToMyReservations">
        <text class="stat-value stat-completed">{{statistics.completed || 0}}</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
      <view class="stat-item" bindtap="navigateToMyReservations">
        <text class="stat-value stat-cancelled">{{statistics.cancelled || 0}}</text>
        <text class="stat-label">å·²å–æ¶ˆ</text>
      </view>
    </view>
  </view>
</view>
